<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atacama NightSky | Tours Astronómicos en San Pedro de Atacama</title>
    <meta name="description" content="Atacama NightSky: Tours guiados con telescopio Unistellar en el desierto más claro del mundo. Observación de estrellas, astrofotografía y experiencias únicas.">
    <meta name="keywords" content="Atacama NightSky, tours astronómicos San Pedro de Atacama, observación estrellas Atacama, telescopio Unistellar, astro turismo Chile">
    
    <!-- Performance Optimizations -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preconnect" href="https://apis.google.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Tours Astronómicos en San Pedro de Atacama">
    <meta property="og:description" content="Descubre el cielo más puro del mundo con nuestros tours guiados">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://toursastronomicosatacama.cl">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    
    <!-- Optimized Google Fonts with preload and font metrics -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"></noscript>
    
    <!-- Defer non-critical CSS -->
    
    
    
    <!-- Critical CSS inlined for above-the-fold -->
    <style>
    *{margin:0;padding:0;box-sizing:border-box}:root{--primary-color:#00D4FF;--secondary-color:#7B68EE;--accent-color:#FF6B6B;--bg-primary:#0a0a0a;--bg-secondary:#1a1a2e;--bg-tertiary:#16213e;--text-primary:#ffffff;--text-secondary:#b8b8b8;--font-primary:'Roboto',-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif;--font-weight-normal:400;--font-weight-bold:700;--spacing-xs:.5rem;--spacing-sm:1rem;--spacing-md:2rem;--border-radius:8px;--transition-normal:.3s ease;--z-header:1000}html{scroll-behavior:smooth;scroll-padding-top:80px}body{font-family:var(--font-primary);font-weight:var(--font-weight-normal);line-height:1.6;color:var(--text-primary);background:var(--bg-primary);overflow-x:hidden}.container{max-width:1200px;margin:0 auto;padding:0 var(--spacing-sm)}h1{font-weight:var(--font-weight-bold);line-height:1.2;margin-bottom:var(--spacing-sm);font-size:clamp(2rem,5vw,3.5rem)}p{margin-bottom:var(--spacing-sm);font-size:clamp(1rem,2vw,1.1rem)}.header{position:fixed;top:0;left:0;right:0;background:rgba(10,10,10,.95);backdrop-filter:blur(10px);border-bottom:1px solid rgba(255,215,0,.1);z-index:var(--z-header);transition:all var(--transition-normal)}.navbar{padding:var(--spacing-sm) 0}.nav-container{display:flex;align-items:center;justify-content:space-between;max-width:1200px;margin:0 auto;padding:0 var(--spacing-sm)}.logo-img{height:40px;width:auto;border-radius:var(--border-radius);transition:all var(--transition-normal)}.hero{position:relative;height:100vh;display:flex;align-items:center;justify-content:center;overflow:hidden}.hero-background{position:absolute;top:0;left:0;right:0;bottom:0;background:none;background-size:cover;background-position:center}.hero-content{position:relative;z-index:2;text-align:center;max-width:800px;padding:var(--spacing-md)}.hero-title{margin-bottom:var(--spacing-md);line-height:1.3;text-align:center;display:flex;flex-direction:column;align-items:center;justify-content:center}.title-line{display:block;position:relative}.hero-subtitle{font-size:clamp(1.1rem,2.5vw,1.3rem);color:var(--text-secondary);margin-bottom:var(--spacing-md);line-height:1.5}.hero-buttons{display:flex;gap:var(--spacing-sm);justify-content:center;flex-wrap:wrap}.btn{display:inline-flex;align-items:center;justify-content:center;gap:var(--spacing-xs);padding:0.875rem 1.5rem;border:none;border-radius:var(--border-radius);font-family:var(--font-primary);font-size:1rem;font-weight:var(--font-weight-bold);text-decoration:none;cursor:pointer;transition:all var(--transition-normal);white-space:nowrap}.btn-primary{background:linear-gradient(45deg,var(--primary-color) 0%,var(--secondary-color) 100%);color:#ffffff}.btn-secondary{background:transparent;color:var(--primary-color);border:2px solid var(--primary-color)}
    
    /* Fallback icon display during font load */
    .fa,.fas,.fab{font-family:"Font Awesome 6 Free","fa-solid-900",monospace!important;font-size:inherit;line-height:1}
    .fab{font-family:"Font Awesome 6 Brands","fa-brands-400",monospace!important;font-size:inherit;line-height:1}
    
    /* Prevent invisible text during font load */
    .fa:before,.fas:before,.fab:before{content:attr(data-icon,"□");display:inline-block;width:1em;text-align:center}
    
    /* CLS Prevention - Stable dimensions for hero content */
    .hero{min-height:100vh!important;position:relative!important}
    .hero-background{position:absolute!important;top:0!important;left:0!important;right:0!important;bottom:0!important;width:100%!important;height:100%!important}
    .hero-bg-img{position:absolute!important;top:0!important;left:0!important;width:100%!important;height:100%!important;object-fit:cover!important;aspect-ratio:16/9!important}
    .hero-content{min-height:60vh!important;display:flex!important;align-items:center!important;justify-content:center!important;position:relative!important;z-index:2!important}
    .hero-title{line-height:1.3!important;margin-bottom:2rem!important;height:auto!important;min-height:8rem!important}
    .title-line{display:block!important;height:1.3em!important;overflow:hidden!important;min-height:1.3em!important}
    .hero-subtitle{height:1.5em!important;line-height:1.5!important;margin-bottom:2rem!important;min-height:1.5em!important;overflow:hidden!important}
    .hero-buttons{height:3.5rem!important;display:flex!important;gap:1rem!important;min-height:3.5rem!important;align-items:center!important;justify-content:center!important}
    
    /* Font loading stability with metric overrides */
    @font-face{font-family:'Roboto Fallback';src:local('Arial');size-adjust:107%;ascent-override:95%;descent-override:25%;line-gap-override:0%}
    body,h1,h2,h3,p{font-family:'Roboto','Roboto Fallback',system-ui,-apple-system,sans-serif!important}
    
    /* Stable text rendering during font load */
    .hero-title,.hero-subtitle{font-kerning:none;font-feature-settings:normal;text-rendering:optimizeSpeed}
    
    /* Language dropdown stable positioning */
    .lang-dropdown{position:absolute;top:100%;right:0;min-width:150px;width:150px;transform:translateY(-100%);transition:transform 0.3s ease,opacity 0.3s ease;opacity:0;pointer-events:none;z-index:1001}
    .lang-dropdown.show{transform:translateY(0);opacity:1;pointer-events:auto}
    
    /* Additional CLS prevention for dynamic elements */
    .nav-container{height:60px;min-height:60px}
    .navbar{min-height:60px}
    .logo-img{width:40px;height:40px;flex-shrink:0}
    .lang-selector{position:relative;width:60px;height:40px}
    .lang-btn{width:60px;height:40px;padding:0;border:none;background:transparent}
    
    /* Prevent layout shifts from images */
    img{max-width:100%;height:auto}
    picture{display:block}
    
    /* Stable button dimensions */
    .btn{min-width:120px;white-space:nowrap}
    .hero-buttons .btn{flex-shrink:0}
    </style>
    
    <!-- Preload LCP hero image for faster rendering -->
    <link rel="preload" as="image" href="images/optimized/hero1-desktop.webp" imagesrcset="images/optimized/hero1-mobile.webp 480w, images/optimized/hero1-tablet.webp 768w, images/optimized/hero1-desktop.webp 1200w" imagesizes="100vw">

    <!-- Load full CSS after initial render -->
    <link rel="preload" href="styles.css?v=4.2" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="styles.css?v=4.2"></noscript>
</head>
<body>
    <!-- Header Navigation -->
    <header class="header" role="banner">
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-logo">
                    <a href="#inicio">
                        <picture>
                            <source srcset="images/responsive/Nightskylogo-1x.webp 1x, images/responsive/Nightskylogo-2x.webp 2x" type="image/webp">
                            <img src="images/responsive/Nightskylogo-1x.jpg" 
                                 srcset="images/responsive/Nightskylogo-1x.jpg 1x, images/responsive/Nightskylogo-2x.jpg 2x"
                                 alt="Atacama NightSky Logo" 
                                 class="logo-img" 
                                 width="40" 
                                 height="40"
                                 fetchpriority="low"
                                 decoding="async">
                        </picture>
                    </a>
                </div>
                
                <!-- Language Toggle -->
                <div class="language-toggle">
                    <div class="lang-selector">
                        <button id="lang-toggle" class="lang-btn">
                            <i class="fas fa-globe"></i>
                            <span id="current-lang">ES</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="lang-dropdown" id="lang-dropdown">
                            <div class="lang-option" data-lang="es">
                                <span class="flag">🇪🇸</span>
                                <span>Español</span>
                            </div>
                            <div class="lang-option" data-lang="en">
                                <span class="flag">🇺🇸</span>
                                <span>English</span>
                            </div>
                            <div class="lang-option" data-lang="pt">
                                <span class="flag">🇧🇷</span>
                                <span>Português</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Desktop Menu -->
                <ul class="nav-menu">
                    <li class="nav-item"><a href="#inicio" class="nav-link">Inicio</a></li>
                    <li class="nav-item"><a href="#tours" class="nav-link">Tours</a></li>
                    <li class="nav-item"><a href="#telescopio" class="nav-link">Telescopio</a></li>
                    <li class="nav-item"><a href="#nosotros" class="nav-link">Sobre Mí</a></li>
                    <li class="nav-item"><a href="#reservas" class="nav-link">Reservas</a></li>
                    <li class="nav-item"><a href="#contacto" class="nav-link">Contacto</a></li>
                    <li class="nav-item">
                        <a href="#reservas" class="cta-button">Reserva Ahora</a>
                    </li>
                </ul>
                
                <!-- Mobile Menu Toggle -->
                <div class="hamburger">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </div>
            </div>
        </nav>
    </header>

    <!-- Hero Section -->
    <section id="inicio" class="hero" role="main">
        <div class="hero-background">
            <picture>
                <source srcset="images/optimized/hero1-mobile.webp 480w, images/optimized/hero1-tablet.webp 768w, images/optimized/hero1-desktop.webp 1200w" 
                        type="image/webp"
                        width="1920"
                        height="1080">
                <img class="hero-bg-img"
                     src="images/optimized/hero1-desktop.jpg"
                     srcset="images/optimized/hero1-mobile.jpg 480w, images/optimized/hero1-tablet.jpg 768w, images/optimized/hero1-desktop.jpg 1200w"
                     sizes="100vw"
                     width="1920"
                     height="1080"
                     alt="Cielo nocturno de Atacama, fondo del héroe"
                     fetchpriority="high"
                     decoding="sync">
            </picture>
        </div>
        <div class="hero-content">
            <div class="container">
                <h1 class="hero-title" id="hero-title-animated">
                    <span class="title-line title-line-1">Atacama Dark Skies</span>
                    <span class="title-line title-line-2">Descubre el cosmos </span>
                    <span class="title-line title-line-3">En el desierto de Atacama</span>
                </h1>
                <p class="hero-subtitle">Un viaje a través de nebulosas y mundos distantes</p>
                <div class="hero-buttons">
                    <a href="#reservas" class="btn btn-primary">Reserva Tu Tour</a>
                    <a href="#tours" class="btn btn-secondary">Ver Tours</a>
                </div>
            </div>
        </div>
        <div class="scroll-indicator">
            <i class="fas fa-chevron-down"></i>
        </div>
    </section>

    <!-- About Us Section -->

    <!-- Tours Section -->
    <section id="tours" class="tours">
        <div class="container">
            <div class="section-header">
                <h2>Nuestros Tours Astronómicos</h2>
                <p class="section-subtitle">Experiencias únicas bajo el cielo más claro del mundo</p>
            </div>
            
            <div class="tours-grid">
                <!-- Tour 1: Complete Experience -->
                <div class="tour-card featured">
                    <div class="featured-badge">Más Popular</div>
                    <div class="tour-image">
                        <picture>
                            <source srcset="images/responsive/regular3-2-1x.webp" type="image/webp">
                            <img src="images/responsive/regular3-2-1x.jpg"
                                 alt="Tour astronómico regular con telescopio profesional"
                                 loading="lazy"
                                 decoding="async"
                                 fetchpriority="low"
                                 width="380"
                                 height="380">
                        </picture>
                    </div>
                    <div class="tour-content">
                        <h3>Tour Astronómico Regular</h3>
                        <div class="tour-price">$30.000</div>
                        <p>Observación a ojo desnudo con puntero láser, charla sobre el universo, observación por telescopio inteligente, cóctel bajo las estrellas y sesión de fotos.</p>
                        
                        <div class="tour-details">
                            <div class="detail">
                                <i class="fas fa-clock"></i>
                                <span>2.5 horas</span>
                            </div>
                            <div class="detail">
                                <i class="fas fa-users"></i>
                                <span>Max 16 personas</span>
                            </div>
                        </div>
                        
                        <div class="tour-includes">
                            <h4>Incluye:</h4>
                            <ul>
                                <li><i class="fas fa-check"></i> Transporte desde/hacia hotel</li>
                                <li><i class="fas fa-check"></i> Guía astronómico certificado</li>
                                <li><i class="fas fa-check"></i> Observación con puntero láser</li>
                                <li><i class="fas fa-check"></i> Telescopio Unistellar eVscope</li>
                                <li><i class="fas fa-check"></i> Cóctel bajo las estrellas</li>
                                <li><i class="fas fa-check"></i> Sesión de fotografías</li>
                            </ul>
                        </div>
                        
                        <a href="#reservas" class="btn btn-primary btn-tour">Reservar Tour</a>
                    </div>
                </div>
                
                <!-- Tour 2: Astrophotography -->
                <div class="tour-card">
                    <div class="tour-image">
                        <picture>
                            <source srcset="images/responsive/fotografico-1x.webp" type="image/webp">
                            <img src="images/responsive/fotografico-1x.jpg"
                                 alt="Tour de astrofotografía especializado con eVscope"
                                 loading="lazy"
                                 decoding="async"
                                 fetchpriority="low"
                                 width="444"
                                 height="250">
                        </picture>
                    </div>
                    <div class="tour-content">
                        <h3>Tour de Astrofotografía Especializado</h3>
                        <div class="tour-price">$120.000</div>
                        <p>Aprende técnicas profesionales de astrofotografía con equipos especializados en distintas locaciones alrrededor de San Pedro de Atacama que parecen de otro planeta. Incluye configuración de cámara, técnicas avanzadas y edición básica.</p>
                        
                        <div class="tour-details">
                            <div class="detail">
                                <i class="fas fa-clock"></i>
                                <span>5 horas</span>
                            </div>
                            <div class="detail">
                                <i class="fas fa-users"></i>
                                <span>Max 4 personas</span>
                            </div>
                        </div>
                        
                        <div class="tour-includes">
                            <h4>Incluye:</h4>
                            <ul>
                                <li><i class="fas fa-check"></i> Instructor especializado</li>
                                <li><i class="fas fa-check"></i> Transporte en camioneta</li>
                                <li><i class="fas fa-check"></i> Trípodes y accesorios</li>
                                <li><i class="fas fa-check"></i> Sesión de edición</li>
                                
        
                            </ul>
                        </div>
                        
                        <a href="#reservas" class="btn btn-primary btn-tour">Reservar Tour</a>
                    </div>
                </div>
                
                <!-- Tour 3: Private VIP -->
                <div class="tour-card">
                    <div class="tour-image">
                        <picture>
                            <source srcset="images/responsive/privado1-1x.webp" type="image/webp">
                            <img src="images/responsive/privado1-1x.jpg"
                                 alt="Tour privado VIP exclusivo bajo las estrellas"
                                 loading="lazy"
                                 decoding="async"
                                 fetchpriority="low"
                                 width="380"
                                 height="346">
                        </picture>
                    </div>
                    <div class="tour-content">
                        <h3>Tour Privado VIP</h3>
                        <div class="tour-price">$200.000</div>
                        <p>Experiencia exclusiva totalmente personalizada. Ideal para ocasiones especiales, parejas o familias que buscan privacidad absoluta en un lugar único en el mundo.</p>
                        
                        <div class="tour-details">
                            <div class="detail">
                                <i class="fas fa-clock"></i>
                                <span>3 horas</span>
                            </div>
                            <div class="detail">
                                <i class="fas fa-users"></i>
                                <span>1-4 personas</span>
                            </div>
                        </div>
                        
                        <div class="tour-includes">
                            <h4>Incluye:</h4>
                            <ul>
                                <li><i class="fas fa-check"></i> Guía astronómico exclusivo</li>
                                <li><i class="fas fa-check"></i> Ubicación privada privilegiada</li>
                                <li><i class="fas fa-check"></i> Telescopio Unistellar dedicado</li>
        
                                <li><i class="fas fa-check"></i> Sesión fotográfica en locaciones únicas</li>
                    
                            </ul>
                        </div>
                        
                        <a href="#reservas" class="btn btn-primary btn-tour">Reservar Tour</a>
                    </div>
                </div>
                
                <!-- Tour 4: Educational Study Tours -->
                <div class="tour-card">
                    <div class="tour-image">
                        <picture>
                            <source srcset="images/responsive/_DSC1725-1x.webp" type="image/webp">
                            <img src="images/responsive/_DSC1725-1x.jpg"
                                 alt="Viajes de estudio educativos con telescopio"
                                 loading="lazy"
                                 decoding="async"
                                 fetchpriority="low"
                                 width="380"
                                 height="294">
                        </picture>
                    </div>
                    <div class="tour-content">
                        <h3>Viajes de Estudio</h3>
                        <div class="tour-price">$15.000</div>
                        <p>Programas educativos especializados para colegios, universidades e institutos. Contenido adaptado según nivel académico con material didáctico incluido.</p>
                        
                        <div class="tour-details">
                            <div class="detail">
                                <i class="fas fa-clock"></i>
                                <span>2.5 horas</span>
                            </div>
                            <div class="detail">
                                <i class="fas fa-users"></i>
                                <span>Grupos 15-30</span>
                            </div>
                        </div>

                        <div class="tour-includes">
                            <h4>Incluye:</h4>
                            <ul>
                                <li><i class="fas fa-check"></i> Material didáctico especializado</li>
                                <li><i class="fas fa-check"></i> Charlas magistrales personalizadas</li>
                                <li><i class="fas fa-check"></i> Actividades grupales interactivas</li>
                                <li><i class="fas fa-check"></i> Certificados de participación</li>
                                <li><i class="fas fa-check"></i> Transporte grupal incluido</li>
                            </ul>
                        </div>
                        
                        <a href="https://wa.me/56950558761?text=Hola!%20Me%20interesa%20cotizar%20un%20*Viaje%20de%20Estudio*%20astronómico%20para%20mi%20grupo.%20¿Podrían%20enviarme%20información%20detallada%20sobre%20disponibilidad,%20precios%20y%20opciones%20educativas?" target="_blank" class="btn btn-primary btn-tour">Solicitar Cotización</a>
                    </div>
                </div>
                
                <!-- Tour 5: Corporate Events -->
                <div class="tour-card featured">
                    <div class="featured-badge">Empresas</div>
                    <div class="tour-image">
                        <picture>
                            <source srcset="images/responsive/ejecutivo-1x.webp" type="image/webp">
                            <img src="images/responsive/ejecutivo-1x.jpg"
                                 alt="Eventos corporativos bajo las estrellas"
                                 loading="lazy"
                                 decoding="async"
                                 fetchpriority="low"
                                 width="380"
                                 height="380">
                        </picture>
                    </div>
                    <div class="tour-content">
                        <h3>Eventos Corporativos</h3>
                        <div class="tour-price">Cotizar</div>
                        <p>Team building bajo las estrellas. Fortalece vínculos empresariales con experiencias astronómicas únicas diseñadas para fortalecer equipos.</p>
                        
                        <div class="tour-details">
                            <div class="detail">
                                <i class="fas fa-clock"></i>
                                <span>4-5 horas</span>
                            </div>
                            <div class="detail">
                                <i class="fas fa-users"></i>
                                <span>10-50 personas</span>
                            </div>
                        </div>

                        <div class="tour-includes">
                            <h4>Incluye:</h4>
                            <ul>
                                <li><i class="fas fa-check"></i> Charlas motivacionales personalizadas</li>
                                <li><i class="fas fa-check"></i> Actividades de team building</li>
                                <li><i class="fas fa-check"></i> Cóctel y catering premium</li>
                                <li><i class="fas fa-check"></i> Transporte ejecutivo incluido</li>
                                <li><i class="fas fa-check"></i> Fotografía corporativa profesional</li>
                            </ul>
                        </div>
                        
                        <a href="https://wa.me/56950558761?text=Hola!%20Me%20interesa%20cotizar%20un%20*Evento%20Corporativo*%20astronómico%20para%20mi%20empresa.%20¿Podrían%20enviarme%20información%20sobre%20disponibilidad,%20precios%20y%20opciones%20de%20team%20building?" target="_blank" class="btn btn-primary btn-tour">Solicitar Cotización</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Booking Section -->

    <!-- Telescope Section -->
    <section id="telescopio" class="telescope">
        <div class="container">
            <div class="section-header">
                <h2>Nuestro Telescopio Unistellar eVscope 2</h2>
                <p class="section-subtitle">Tecnología revolucionaria que captura la belleza del espacio profundo en tiempo real</p>
            </div>
            
            <div class="telescope-content">
                <div class="telescope-info">
                    <div class="telescope-features">
                        <h3>Tecnología de Vanguardia</h3>
                        <p>El telescopio Unistellar eVscope 2 utiliza tecnología revolucionaria que permite observar objetos del espacio profundo a color que normalmente son invisibles al ojo humano.</p>
                        
                    </div>
                </div>
                
                <div class="telescope-gallery">
                    <h3>Galería del Espacio Profundo</h3>
                    <p>Estas son fotografías reales capturadas con nuestro telescopio Unistellar durante nuestros tours</p>
                    
                    <script>
                        function abrirImagen(src) {
                            console.log('🔍 Abriendo:', src);
                            const modal = document.getElementById('galleryModal');
                            const img = document.getElementById('modalImage');
                            if(modal && img) {
                                img.src = src;
                                modal.style.display = 'flex';
                            }
                        }
                    </script>
                    
                    <div class="gallery-container">
                        <!-- Gallery Carousel -->
                        <div class="gallery-carousel" id="telescopeCarousel">
                            <div class="carousel-track" id="carouselTrack">
                                <!-- Slide 1 -->
                                <div class="carousel-slide active">
                                    <div class="gallery-grid">
                                        <div class="gallery-item" onclick="abrirImagen('images/eVscope2-20250418-015040.jpg')">
                                            <img src="images/eVscope2-20250418-015040.jpg" alt="Objeto del espacio profundo capturado con eVscope" loading="lazy">
                                            <div class="gallery-overlay">
                                                <i class="fas fa-search-plus"></i>
                                            </div>
                                        </div>
                                        <div class="gallery-item" onclick="abrirImagen('images/eVscope2-20250520-005028.jpg')">
                                            <img src="images/eVscope2-20250520-005028.jpg" alt="Nebulosa capturada con telescopio Unistellar" loading="lazy">
                                            <div class="gallery-overlay">
                                                <i class="fas fa-search-plus"></i>
                                            </div>
                                        </div>
                                        <div class="gallery-item" onclick="abrirImagen('images/eVscope2-20250525-021351.jpg')">
                                            <picture>
                                                <source srcset="images/responsive/eVscope2-20250525-021351-1x.webp 1x, images/responsive/eVscope2-20250525-021351-2x.webp 2x" type="image/webp">
                                                <img src="images/responsive/eVscope2-20250525-021351-1x.jpg" 
                                                     srcset="images/responsive/eVscope2-20250525-021351-1x.jpg 1x, images/responsive/eVscope2-20250525-021351-2x.jpg 2x"
                                                     alt="Galaxia fotografiada con eVscope2" 
                                                     loading="lazy" 
                                                     width="253" 
                                                     height="190">
                                            </picture>
                                            <div class="gallery-overlay">
                                                <i class="fas fa-search-plus"></i>
                                            </div>
                                        </div>
                                        <div class="gallery-item" onclick="abrirImagen('images/eVscope2-20250629-012206.jpg')">
                                            <img src="images/eVscope2-20250629-012206.jpg" alt="Cúmulo estelar capturado durante tour astronómico" loading="lazy">
                                            <div class="gallery-overlay">
                                                <i class="fas fa-search-plus"></i>
                                            </div>
                                        </div>
                                        <div class="gallery-item" onclick="abrirImagen('images/eVscope2-20250629-013307.jpg')">
                                            <img src="images/eVscope2-20250629-013307.jpg" alt="Objeto celeste fotografiado con telescopio Unistellar" loading="lazy">
                                            <div class="gallery-overlay">
                                                <i class="fas fa-search-plus"></i>
                                            </div>
                                        </div>
                                        <div class="gallery-item" onclick="abrirImagen('images/eVscope2-20250629-013312.jpg')">
                                            <img src="images/eVscope2-20250629-013312.jpg" alt="Astrofotografía del espacio profundo con eVscope" loading="lazy">
                                            <div class="gallery-overlay">
                                                <i class="fas fa-search-plus"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Slide 2 -->
                                <div class="carousel-slide">
                                    <div class="gallery-grid">
                                        <div class="gallery-item" onclick="abrirImagen('images/eVscope2-20250719-001348.jpg')">
                                            <img src="images/eVscope2-20250719-001348.jpg" alt="Nebulosa del Anillo capturada con eVscope" loading="lazy">
                                            <div class="gallery-overlay">
                                                <i class="fas fa-search-plus"></i>
                                            </div>
                                        </div>
                                        <div class="gallery-item" onclick="abrirImagen('images/eVscope2-20250803-004143.jpg')">
                                            <img src="images/eVscope2-20250803-004143.jpg" alt="Galaxia espiral fotografiada con telescopio Unistellar" loading="lazy">
                                            <div class="gallery-overlay">
                                                <i class="fas fa-search-plus"></i>
                                            </div>
                                        </div>
                                        <div class="gallery-item" onclick="abrirImagen('images/eVscope2-20250803-004145.jpg')">
                                            <img src="images/eVscope2-20250803-004145.jpg" alt="Cúmulo globular del espacio profundo" loading="lazy">
                                            <div class="gallery-overlay">
                                                <i class="fas fa-search-plus"></i>
                                            </div>
                                        </div>
                                        <div class="gallery-item" onclick="abrirImagen('images/eVscope2-20250803-032904.jpg')">
                                            <img src="images/eVscope2-20250803-032904.jpg" alt="Nebulosa planetaria capturada en Atacama" loading="lazy">
                                            <div class="gallery-overlay">
                                                <i class="fas fa-search-plus"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Carousel Controls -->
                            <button class="carousel-control prev" id="carouselPrev" onclick="
                                console.log('⬅️ PREV CLICKED!'); 
                                { const trackEl = document.getElementById('carouselTrack');
                                  if(trackEl) trackEl.style.transform = 'translateX(0%)'; }
                            ">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="carousel-control next" id="carouselNext" onclick="
                                console.log('➡️ NEXT CLICKED!'); 
                                { const trackEl = document.getElementById('carouselTrack');
                                  if(trackEl) trackEl.style.transform = 'translateX(-50%)'; }
                            ">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                            
                            <!-- Carousel Indicators -->
                        <div class="carousel-indicators" aria-label="Selector de imágenes de telescopio">
                            <button class="indicator active" data-slide="0" aria-label="Slide 1" aria-current="true" role="tab"></button>
                            <button class="indicator" data-slide="1" aria-label="Slide 2" role="tab"></button>
                        </div>
                        </div>
                        
                        <!-- Gallery Modal -->
                        <div id="galleryModal" class="gallery-modal" onclick="window.closeGalleryModal()">
                            <div class="modal-content" onclick="event.stopPropagation()">
                                <span class="close-modal" onclick="
                                    console.log('❌ CLOSE CLICKED!');
                                    document.getElementById('galleryModal').style.display = 'none';
                                ">&times;</span>
                                <img id="modalImage" src="" alt="Imagen ampliada del telescopio">
                                <div class="modal-nav">
                                    <button id="prevImage" class="nav-btn prev-btn">
                                        <i class="fas fa-chevron-left"></i>
                                    </button>
                                    <button id="nextImage" class="nav-btn next-btn">
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->

  


    <!-- Booking Section -->
    <section id="reservas" class="booking">     
        <div class="container">
            <div class="section-header">
                <h2>Reserva Tu Experiencia Astronómica</h2>
                <p class="section-subtitle">Completa el formulario y te contactaremos para confirmar disponibilidad</p>
            </div>
            
            <div class="booking-content">
                <div class="booking-form-container">
                    <form id="booking-form" class="booking-form" name="booking">
                        
                        <!-- Calendar Section with FullCalendar -->
                        
                        <div class="form-group calendar-section">
                            <label for="calendar">Selecciona Fecha y Hora *</label>
                            
                            <div id="calendar-container">
                                <div id="fullcalendar"></div>
                            
                            <!-- Selected Date Display -->
                            <div class="selected-date-display" id="selected-date-display">
                                Haz clic en una fecha disponible para continuar
                            </div>
                            
                            <input type="hidden" id="selected-date" name="date" required>
                        </div>
                        
                        <!-- Datos de la reserva -->
                        <div class="form-section">
                            <h4>Datos de tu Reserva</h4>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="persons">Número de Personas *</label>
                                <select id="persons" name="persons" required aria-required="true">
                                    <option value="">Selecciona cantidad</option>
                                    <option value="1">1 persona</option>
                                    <option value="2">2 personas</option>
                                    <option value="3">3 personas</option>
                                    <option value="4">4 personas</option>
                                    <option value="5">5 personas</option>
                                    <option value="6">6 personas</option>
                                    <option value="7">7 personas</option>
                                    <option value="8">8 personas</option>
                                    <option value="9">9 personas</option>
                                    <option value="10">10 personas</option>
                                    <option value="11">11 personas</option>
                                    <option value="12">12 personas</option>
                                    <option value="13">13 personas</option>
                                    <option value="14">14 personas</option>
                                    <option value="15">15 personas</option>
                                    <option value="16">16 personas</option>
                                    <option value="16+">Más de 16 personas (contactar)</option>
                                </select>
                                <div id="availability-warning" class="availability-warning" style="display: none;">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <span class="warning-text"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="tour-type">Tipo de Tour *</label>
                                <select id="tour-type" name="tour-type" required>
                                    <option value="">Selecciona tipo de tour</option>
                                    <option value="regular">Tour Regular (Grupo)</option>
                                    <option value="private">Tour Privado (Solo tu grupo)</option>
                                    <option value="astrophoto">Tour Astrofotográfico (Especializado)</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Información de contacto -->
                        <div class="form-section">
                            <h4>Información de Contacto</h4>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="name">Nombre Completo *</label>
                                <input type="text" id="name" name="name" required aria-required="true" placeholder="Tu nombre completo">
                            </div>
                            <div class="form-group">
                                <label for="email">Email *</label>
                                <input type="email" id="email" name="email" required aria-required="true" placeholder="tu@email.com">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="phone">Teléfono/WhatsApp *</label>
                            <input type="tel" id="phone" name="phone" required aria-required="true" placeholder="+56 9 1234 5678">
                        </div>
                        
                        <div class="form-group">
                            <label for="message">Mensaje Adicional</label>
                            <textarea id="message" name="message" rows="4" placeholder="¿Alguna pregunta o requerimiento especial?"></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-submit">
                            <i class="fas fa-paper-plane"></i>
                            Enviar Reserva
                        </button>
                        
                        <div class="form-success" id="form-success">
                            <i class="fas fa-check-circle"></i>
                            <h3>¡Reserva Enviada!</h3>
                            <p>Te contactaremos dentro de 24 horas para confirmar disponibilidad y detalles del pago.</p>
                        </div>
                    </form>
                </div>
                
                <div class="booking-info">
                    <div class="info-card">
                        <i class="fas fa-clock"></i>
                        <h4>Horarios</h4>
                        <p>Tours nocturnos desde 20:00 hrs<br>Duración: 2.5 - 4+ horas</p>
                    </div>
                    
                    <div class="info-card">
                        <i class="fas fa-calendar-alt"></i>
                        <h4>Disponibilidad</h4>
                        <p>Todos los días del año, excepto 3 dias antes y después de luna llena<br>Sujeto a condiciones climáticas</p>
                    </div>
                    
                    <div class="info-card">
                        <i class="fas fa-map-marker-alt"></i>
                        <h4>Punto de Encuentro</h4>
                        <p>Recogida en hoteles de San Pedro de Atacama incluida</p>
                    </div>
                    
                    <div class="info-card">
                        <i class="fas fa-credit-card"></i>
                        <h4>Formas de Pago</h4>
                        <p>Efectivo, Transferencia, PayPal<br>50% anticipo - 50% al inicio del tour</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

      <!-- About Us Section -->
    <section id="nosotros" class="about">
        <div class="container">
            <div class="section-header">
                <h2>Vicente Litvak</h2>
                <p class="section-subtitle">Sobre mi</p>
            </div>
            
            <div class="about-content">
                <div class="about-text">
                    <p>Más de 7 años guiando tours astronómicos en el Desierto de Atacama a personas de todo el mundo.</p>
                    <p>Mi pasión por la astronomía comenzó desde pequeño, y hoy combino conocimiento científico con tecnología de vanguardia para crear experiencias inolvidables bajo las estrellas.</p>
                    <p>Mi misión es compartir la magia del cielo con el mundo, y que cada persona que visita el Desierto de Atacama se lleve una experiencia única y memorable.</p>
                </div>
                <div class="about-image">
                    <picture>
                        <source srcset="images/responsive/me2-1x.webp 1x, images/responsive/me2-2x.webp 2x" type="image/webp">
                        <img src="images/responsive/me2-1x.jpg" 
                             srcset="images/responsive/me2-1x.jpg 1x, images/responsive/me2-2x.jpg 2x"
                             alt="Guía astronómico en el desierto de Atacama con equipos profesionales" 
                             loading="lazy" 
                             width="400" 
                             height="400">
                    </picture>
                </div>
            </div>
        </div>
    </section>
    <!-- Telescope Section -->

    <!-- Contact Section -->
    <section id="contacto" class="contact">
        <div class="container">
            <div class="section-header">
                <h2>Contacto y Ubicación</h2>
                <p class="section-subtitle">Estamos a 10km al sur de San Pedro en la oscuridad absoluta del desierto de Atacama</p>
            </div>
            
            <div class="contact-content">
                <div class="contact-info">
                        <div class="contact-item">
                            <i class="fas fa-map-marker-alt" aria-hidden="true"></i>
                            <div>
                                <h3>Dirección</h3>
                                <p>Calle Caracoles 123<br>San Pedro de Atacama, Chile</p>
                            </div>
                        </div>
                    
                        <div class="contact-item">
                            <i class="fas fa-phone" aria-hidden="true"></i>
                            <div>
                                <h3>Teléfono</h3>
                                <p><a href="tel:+56955123456">+56 9 3513 4669</a></p>
                            </div>
                        </div>
                    
                        <div class="contact-item">
                            <i class="fas fa-envelope" aria-hidden="true"></i>
                            <div>
                                <h3>Email</h3>
                                <p><a href="mailto:vicente.litvak@gmail.com">vicente.litvak@gmail.com</a></p>
                            </div>
                        </div>
                    
                        <div class="contact-item">
                            <i class="fab fa-whatsapp" aria-hidden="true"></i>
                            <div>
                                <h3>WhatsApp</h3>
                                <p><a href="https://wa.me/56935134669" target="_blank">+56 9 3513 4669</a></p>
                            </div>
                        </div>
                    
                    <div class="social-links">
                        <h4>Síguenos</h4>
                        <div class="social-icons">
                            <a href="#" target="_blank" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
                            <a href="#" target="_blank" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                            <a href="#" target="_blank" aria-label="TripAdvisor"><i class="fab fa-tripadvisor"></i></a>
                            <a href="#" target="_blank" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                        </div>
                    </div>
                </div>
                
                <div class="contact-map">
                    <iframe 
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3655.8890525328354!2d-68.20028768502085!3d-22.911434484260326!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x96ac0919447d2e07%3A0x6b8f1c3c9c2f8c5d!2sSan%20Pedro%20de%20Atacama%2C%20Chile!5e0!3m2!1sen!2scl!4v1643723458123!5m2!1sen!2scl" 
                        width="100%" 
                        height="400" 
                        style="border:0;" 
                        allowfullscreen="" 
                        loading="lazy" 
                        referrerpolicy="no-referrer-when-downgrade"
                        title="Ubicación Tours Astronómicos Atacama en San Pedro de Atacama">
                    </iframe>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <picture>
                            <source srcset="images/responsive/Nightskylogo-1x.webp 1x, images/responsive/Nightskylogo-2x.webp 2x" type="image/webp">
                            <img src="images/responsive/Nightskylogo-1x.jpg" 
                                 srcset="images/responsive/Nightskylogo-1x.jpg 1x, images/responsive/Nightskylogo-2x.jpg 2x"
                                 alt="Atacama NightSky Logo" 
                                 class="footer-logo-img" 
                                 width="40" 
                                 height="40">
                        </picture>
                    </div>
                    <p>Descubre el universo en el cielo más claro del mundo. Experiencias astronómicas inolvidables en San Pedro de Atacama.</p>
                    <div class="footer-social">
                        <a href="#" target="_blank" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
                        <a href="#" target="_blank" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="#" target="_blank" aria-label="TripAdvisor"><i class="fab fa-tripadvisor"></i></a>
                        <a href="#" target="_blank" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h4>Tours</h4>
                    <ul>
                        <li><a href="#tours">Tour Nocturno Básico</a></li>
                        <li><a href="#tours">Tour con Telescopio</a></li>
                        <li><a href="#tours">Tour de Astrofotografía</a></li>
                        <li><a href="#tours">Tour Privado VIP</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Información</h4>
                    <ul>
                        <li><a href="#nosotros">Sobre Nosotros</a></li>
                        <li><a href="#testimonios">Testimonios</a></li>
                        <li><a href="#contacto">Contacto</a></li>
                        <li><a href="#">Preguntas Frecuentes</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Legal</h4>
                    <ul>
                        <li><a href="#">Términos y Condiciones</a></li>
                        <li><a href="#">Política de Privacidad</a></li>
                        <li><a href="#">Política de Cancelación</a></li>
                        <li><a href="#">Política de Reembolso</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2024 Tours Astronómicos Atacama. Todos los derechos reservados.</p>
                <a href="#inicio" class="back-to-top" aria-label="Volver arriba">
                    <i class="fas fa-chevron-up"></i>
                </a>
            </div>
        </div>
    </footer>

    <!-- WhatsApp Float Button -->
    <div class="whatsapp-float">
        <a href="https://wa.me/56935134669?text=Hola!%20Me%20interesa%20información%20sobre%20los%20tours%20astronómicos" target="_blank" aria-label="Contactar por WhatsApp">
            <i class="fab fa-whatsapp"></i>
        </a>
        <div class="whatsapp-tooltip">¿Tienes preguntas? ¡Escríbenos!</div>
    </div>

    <!-- Google APIs -->
    <script src="https://apis.google.com/js/api.js" defer></script>
    
    <!-- JavaScript -->
    <script src="script.js?v=4.1" defer></script>

    <!-- Calendario personalizado con fases lunares -->
    <script>
        // Algoritmo preciso basado en porcentaje de iluminación lunar
        function getMoonPhase(date) {
            // Referencia astronómica precisa: Luna nueva del 6 de enero 2000, 18:14 UTC
            const referenceNewMoon = new Date('2000-01-06T18:14:00Z');
            const lunarCycle = 29.530588853; // Período sinódico lunar en días
            
            // Calcular días desde la referencia
            const daysSinceReference = (date - referenceNewMoon) / (1000 * 60 * 60 * 24);
            
            // Obtener la fase actual en el ciclo (0 = luna nueva, 0.5 = luna llena)
            const phase = (daysSinceReference / lunarCycle) % 1;
            const normalizedPhase = phase < 0 ? phase + 1 : phase;
            
            // Calcular porcentaje de iluminación
            // La iluminación va de 0% (luna nueva) a 100% (luna llena) y vuelta a 0%
            let illumination;
            if (normalizedPhase <= 0.5) {
                // Fase creciente: de 0% a 100%
                illumination = normalizedPhase * 2 * 100;
            } else {
                // Fase menguante: de 100% a 0%
                illumination = (2 - normalizedPhase * 2) * 100;
            }
            
            // Redondear a 1 decimal
            illumination = Math.round(illumination * 10) / 10;
            
            // Determinar disponibilidad basada en iluminación y fase
            // Bloquear solo en fase creciente cuando iluminación > 75%
            // En fase menguante, la luna sale tarde y no interfiere con los tours
            let isNearFullMoon = false;
            
            if (normalizedPhase <= 0.5) {
                // Fase creciente: bloquear si iluminación > 75%
                isNearFullMoon = illumination > 75;
            } else {
                // Fase menguante: solo bloquear si iluminación > 90% (muy cerca de luna llena)
                isNearFullMoon = illumination > 90;
            }
            
            // Calcular días desde la luna llena más cercana (para información)
            let daysFromFullMoon;
            if (normalizedPhase <= 0.5) {
                daysFromFullMoon = (0.5 - normalizedPhase) * lunarCycle;
            } else {
                daysFromFullMoon = (normalizedPhase - 0.5) * lunarCycle;
            }
            
            // Determinar la fase lunar para el emoji y nombre
            let phaseIndex, phaseName, emoji;
            
            if (illumination < 1) {
                phaseIndex = 0; phaseName = 'Nueva'; emoji = '🌑';
            } else if (illumination < 25) {
                phaseIndex = normalizedPhase < 0.5 ? 1 : 7;
                phaseName = normalizedPhase < 0.5 ? 'Creciente' : 'Menguante';
                emoji = normalizedPhase < 0.5 ? '🌒' : '🌘';
            } else if (illumination < 45) {
                phaseIndex = normalizedPhase < 0.5 ? 2 : 6;
                phaseName = normalizedPhase < 0.5 ? 'Cuarto Creciente' : 'Cuarto Menguante';
                emoji = normalizedPhase < 0.5 ? '🌓' : '🌗';
            } else if (illumination < 95) {
                phaseIndex = normalizedPhase < 0.5 ? 3 : 5;
                phaseName = normalizedPhase < 0.5 ? 'Gibosa Creciente' : 'Gibosa Menguante';
                emoji = normalizedPhase < 0.5 ? '🌔' : '🌖';
            } else {
                phaseIndex = 4; phaseName = 'Llena'; emoji = '🌕';
            }
            
            return {
                emoji: emoji,
                name: phaseName,
                illumination: illumination,
                isNearFullMoon: isNearFullMoon,
                daysFromFull: Math.round(daysFromFullMoon * 10) / 10,
                phase: normalizedPhase,
                isFullMoon: illumination > 95,
                isNewMoon: illumination < 5
            };
        }

        // Verificar disponibilidad de fecha
        function isDateAvailable(date) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const checkDate = new Date(date);
            checkDate.setHours(0, 0, 0, 0);
            
            // No disponible si es en el pasado
            if (checkDate < today) return false;
            
            const moonPhase = getMoonPhase(checkDate);
            // Disponible solo si NO está cerca de luna llena
            return !moonPhase.isNearFullMoon;
        }

        // Variables globales del calendario
        let currentDate = new Date();
        let selectedDate = null;

        // Función para obtener textos del calendario traducidos
        function getCalendarText(key, lang) {
            const texts = {
                es: {
                    available: 'Disponible - Condiciones óptimas',
                    unavailable: 'No disponible - Luna muy brillante',
                    info: '🌒 Creciente: bloqueado si >75% iluminación | 🌖 Menguante: bloqueado si >90% iluminación',
                    dateSelected: 'Fecha Seleccionada',
                    excellentConditions: 'Condiciones excelentes para observación estelar',
                    notAvailableTitle: 'Fecha no disponible para tours.',
                    crescentBright: 'La luna creciente está muy brillante',
                    almostFull: 'La luna está casi llena',
                    selectOther: 'Selecciona otra fecha con menos iluminación lunar.',
                    availableOptimal: 'Disponible - Condiciones óptimas',
                    crescentBlocked: 'No disponible - Luna creciente muy brillante (>75%)',
                    fullBlocked: 'No disponible - Luna casi llena (>90%)'
                },
                en: {
                    available: 'Available - Optimal conditions',
                    unavailable: 'Not available - Moon too bright',
                    info: '🌒 Waxing: blocked if >75% illumination | 🌖 Waning: blocked if >90% illumination',
                    dateSelected: 'Date Selected',
                    excellentConditions: 'Excellent conditions for stargazing',
                    notAvailableTitle: 'Date not available for tours.',
                    crescentBright: 'The waxing moon is very bright',
                    almostFull: 'The moon is almost full',
                    selectOther: 'Please select another date with less lunar illumination.',
                    availableOptimal: 'Available - Optimal conditions',
                    crescentBlocked: 'Not available - Waxing moon too bright (>75%)',
                    fullBlocked: 'Not available - Moon almost full (>90%)'
                },
                pt: {
                    available: 'Disponível - Condições ótimas',
                    unavailable: 'Não disponível - Lua muito brilhante',
                    info: '🌒 Crescente: bloqueado se >75% iluminação | 🌖 Minguante: bloqueado se >90% iluminação',
                    dateSelected: 'Data Selecionada',
                    excellentConditions: 'Condições excelentes para observação estelar',
                    notAvailableTitle: 'Data não disponível para tours.',
                    crescentBright: 'A lua crescente está muito brilhante',
                    almostFull: 'A lua está quase cheia',
                    selectOther: 'Selecione outra data com menos iluminação lunar.',
                    availableOptimal: 'Disponível - Condições ótimas',
                    crescentBlocked: 'Não disponível - Lua crescente muito brilhante (>75%)',
                    fullBlocked: 'Não disponível - Lua quase cheia (>90%)'
                }
            };
            
            return texts[lang] && texts[lang][key] ? texts[lang][key] : texts['es'][key];
        }

        // Inicializar calendario cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', function() {
            createCustomCalendar();
        });

        // Crear calendario personalizado
        function createCustomCalendar() {
            const calendarEl = document.getElementById('fullcalendar');
            if (!calendarEl) {
                console.error('Elemento #fullcalendar no encontrado');
                return;
            }

            renderCalendar();
        }

        // Renderizar calendario
        function renderCalendar() {
            const calendarEl = document.getElementById('fullcalendar');
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // Get current language for calendar
            const currentLang = localStorage.getItem('preferred-language') || 'es';
            
            const monthNames = {
                es: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                     'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
                en: ['January', 'February', 'March', 'April', 'May', 'June',
                     'July', 'August', 'September', 'October', 'November', 'December'],
                pt: ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
                     'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro']
            };
            
            const daysOfWeek = {
                es: ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'],
                en: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                pt: ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom']
            };
            
            // Primer día del mes y último día
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            
            // Día de la semana del primer día (0=Domingo, 1=Lunes, etc.)
            let startDay = firstDay.getDay();
            startDay = startDay === 0 ? 6 : startDay - 1; // Convertir para empezar en Lunes
            
            let calendarHTML = `
                <div class="custom-calendar">
                    <div class="calendar-header">
                        <button class="nav-btn" onclick="changeMonth(-1)">‹</button>
                        <h3>${monthNames[currentLang][month]} ${year}</h3>
                        <button class="nav-btn" onclick="changeMonth(1)">›</button>
                    </div>
                    
                    <div class="calendar-weekdays">
                        ${daysOfWeek[currentLang].map(day => `<div class="weekday">${day}</div>`).join('')}
                    </div>
                    
                    <div class="calendar-days">
            `;
            
            // Días vacíos al inicio
            for (let i = 0; i < startDay; i++) {
                calendarHTML += '<div class="calendar-day empty"></div>';
            }
            
            // Días del mes
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const moonPhase = getMoonPhase(date);
                const isAvailable = isDateAvailable(date);
                const isCurrentDay = isToday(date);
                const isSelected = selectedDate && isSameDay(date, selectedDate);
                
                let dayClass = 'calendar-day';
                if (!isAvailable) dayClass += ' unavailable';
                if (isCurrentDay) dayClass += ' today';
                if (isSelected) dayClass += ' selected';
                
                let availabilityText;
                if (isAvailable) {
                    availabilityText = getCalendarText('availableOptimal', currentLang);
                } else {
                    if (moonPhase.phase <= 0.5) {
                        availabilityText = getCalendarText('crescentBlocked', currentLang);
                    } else {
                        availabilityText = getCalendarText('fullBlocked', currentLang);
                    }
                }
                
                calendarHTML += `
                    <div class="${dayClass}" onclick="selectDate(${year}, ${month}, ${day})" 
                         title="${moonPhase.name} ${moonPhase.emoji} - ${moonPhase.illumination}% iluminación - ${availabilityText}">
                        <span class="day-number">${day}</span>
                        <span class="moon-emoji">${moonPhase.emoji}</span>
                    </div>
                `;
            }
            
            calendarHTML += `
                    </div>
                    <div class="calendar-legend">
                        <div class="legend-item">
                            <span class="legend-dot available"></span>
                            <span>${getCalendarText('available', currentLang)}</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot unavailable"></span>
                            <span>${getCalendarText('unavailable', currentLang)}</span>
                        </div>
                    </div>
                    <div class="calendar-info">
                        <p style="font-size: 0.8rem; color: #ccc; margin: 0.5rem 0; text-align: center;">
                            ${getCalendarText('info', currentLang)}
                        </p>
                    </div>
                </div>
            `;
            
            calendarEl.innerHTML = calendarHTML;
        }

        // Cambiar mes
        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            renderCalendar();
        }

        // Seleccionar fecha
        function selectDate(year, month, day) {
            const date = new Date(year, month, day);
            
            if (!isDateAvailable(date)) {
                const moonPhase = getMoonPhase(date);
                const currentLang = localStorage.getItem('preferred-language') || 'es';
                let reason;
                if (moonPhase.phase <= 0.5) {
                    reason = `${getCalendarText('crescentBright', currentLang)} (${moonPhase.illumination}% ${currentLang === 'en' ? 'illumination' : currentLang === 'pt' ? 'iluminação' : 'iluminación'}) ${currentLang === 'en' ? 'and will be visible during the tour, reducing star visibility.' : currentLang === 'pt' ? 'e será visível durante o tour, reduzindo a visibilidade das estrelas.' : 'y será visible durante el tour, reduciendo la visibilidad de las estrellas.'}`;
                } else {
                    reason = `${getCalendarText('almostFull', currentLang)} (${moonPhase.illumination}% ${currentLang === 'en' ? 'illumination' : currentLang === 'pt' ? 'iluminação' : 'iluminación'}) ${currentLang === 'en' ? 'and still too bright for optimal observation.' : currentLang === 'pt' ? 'e ainda muito brilhante para observação ótima.' : 'y aún muy brillante para la observación óptima.'}`;
                }
                alert(`${getCalendarText('notAvailableTitle', currentLang)}\n\n${currentLang === 'en' ? 'Lunar phase' : currentLang === 'pt' ? 'Fase lunar' : 'Fase lunar'}: ${moonPhase.name} ${moonPhase.emoji}\n${currentLang === 'en' ? 'Illumination' : currentLang === 'pt' ? 'Iluminação' : 'Iluminación'}: ${moonPhase.illumination}%\n\n${reason}\n\n${getCalendarText('selectOther', currentLang)}`);
                return;
            }
            
            selectedDate = date;
            renderCalendar();
            
            // Actualizar campo de fecha del formulario
            const dateInput = document.getElementById('selected-date');
            if (dateInput) {
                const dateStr = date.toISOString().split('T')[0];
                dateInput.value = dateStr;
                
                // Trigger change event to notify other systems
                dateInput.dispatchEvent(new Event('change'));
            }
            
            // Update the display element
            const displayElement = document.getElementById('selected-date-display');
            if (displayElement) {
                const currentLang = localStorage.getItem('preferred-language') || 'es';
                const dateStr = date.toLocaleDateString(currentLang === 'en' ? 'en-US' : currentLang === 'pt' ? 'pt-BR' : 'es-ES', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                displayElement.innerHTML = `
                    <div class="selected-datetime">
                        <i class="fas fa-check-circle"></i>
                        <h5>${currentLang === 'en' ? 'Date selected!' : currentLang === 'pt' ? 'Data selecionada!' : '¡Fecha seleccionada!'}</h5>
                        <p><strong>📅 ${dateStr}</strong></p>
                        <small>${currentLang === 'en' ? 'Now select tour type and time below' : currentLang === 'pt' ? 'Agora selecione o tipo de tour e horário abaixo' : 'Ahora selecciona el tipo de tour y horario abajo'}</small>
                    </div>
                `;
                displayElement.classList.add('has-date');
            }
            
            // Mostrar confirmación
            showDateConfirmation(date);
        }

        // Mostrar confirmación de fecha seleccionada
        function showDateConfirmation(date) {
            const moonPhase = getMoonPhase(date);
            const currentLang = localStorage.getItem('preferred-language') || 'es';
            
            let locale = 'es-ES';
            if (currentLang === 'en') locale = 'en-US';
            if (currentLang === 'pt') locale = 'pt-BR';
            
            const dateStr = date.toLocaleDateString(locale, {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            let confirmDiv = document.getElementById('date-confirmation');
            if (!confirmDiv) {
                confirmDiv = document.createElement('div');
                confirmDiv.id = 'date-confirmation';
                confirmDiv.className = 'date-confirmation';
                document.getElementById('fullcalendar').parentNode.appendChild(confirmDiv);
            }
            
            const illuminationLabel = currentLang === 'en' ? 'illumination' : currentLang === 'pt' ? 'iluminação' : 'iluminación';
            
            confirmDiv.innerHTML = `
                <div class="confirmation-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h4>${getCalendarText('dateSelected', currentLang)}</h4>
                <p><strong>📅 ${dateStr}</strong></p>
                <p>${moonPhase.emoji} ${moonPhase.name} - ${moonPhase.illumination}% ${illuminationLabel}</p>
                <p class="conditions">${getCalendarText('excellentConditions', currentLang)}</p>
            `;
        }

        // Funciones auxiliares
        function isToday(date) {
            const today = new Date();
            return isSameDay(date, today);
        }

        function isSameDay(date1, date2) {
            return date1.getDate() === date2.getDate() &&
                   date1.getMonth() === date2.getMonth() &&
                   date1.getFullYear() === date2.getFullYear();
        }
    </script>

    <!-- Google Calendar Integration -->
    <script>
        // Google Calendar API Configuration
        const GOOGLE_CLIENT_ID = '648205695741-7ejai0lssibtachurp1o4ntsdv4nee0s.apps.googleusercontent.com'; // Tu Client ID real
        const GOOGLE_API_KEY = 'AIzaSyD1-kWnLi0Qcp5dI-TQgY4ADKWtl2mjTSU'; // Tu API Key
        const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest';
        const SCOPES = 'https://www.googleapis.com/auth/calendar';
        const CALENDAR_ID = 'vicente.litvak@gmail.com'; // Tu email de Google Calendar

        let gapi;
        let googleCalendarReady = false;

        // Inicializar Google API cuando se carga la página
        function initializeGoogleAPI() {
            gapi.load('api:auth2', async () => {
                try {
                    await gapi.api.init({
                        apiKey: GOOGLE_API_KEY,
                        clientId: GOOGLE_CLIENT_ID,
                        discoveryDocs: [DISCOVERY_DOC],
                        scope: SCOPES
                    });
                    
                    googleCalendarReady = true;
                    console.log('Google Calendar API initialized successfully');
                } catch (error) {
                    console.error('Error initializing Google Calendar API:', error);
                }
            });
        }

        // Función para crear evento en Google Calendar
        async function createCalendarEvent(reservationData) {
            if (!googleCalendarReady) {
                console.warn('Google Calendar API not ready');
                return false;
            }

            try {
                // Verificar si el usuario está autenticado
                const authInstance = gapi.auth2.getAuthInstance();
                if (!authInstance.isSignedIn.get()) {
                    // Solicitar autorización
                    await authInstance.signIn();
                }

                // Crear objeto del evento
                const tourTypeText = reservationData.tourType === 'private' ? 'PRIVADO' : 'REGULAR';
                const event = {
                    'summary': `Tour ${tourTypeText} - ${reservationData.persons} ${reservationData.persons === '1' ? 'persona' : 'personas'}`,
                    'description': `Tour Astronómico Atacama NightSky
                    
📊 DETALLES DE LA RESERVA:
🎯 Tipo: Tour ${tourTypeText}
👥 Pasajeros: ${reservationData.persons}
📧 Contacto: ${reservationData.name} (${reservationData.email})
📱 Teléfono: ${reservationData.phone || 'No proporcionado'}
💬 Comentarios: ${reservationData.comments || 'Ninguno'}

🌙 CONDICIONES LUNARES:
${reservationData.moonPhase || 'Condiciones óptimas para observación'}

⏰ HORARIO Y DURACIÓN:
${reservationData.tourType === 'private' ? '🎯 Tour Privado - Duración: 3-4 horas' : '👥 Tour Regular - Duración: 3 horas'}

🔗 SITIO WEB: https://atacamadarksky.cl
📞 CONTACTO EMERGENCIA: +56 9 3513 4669`,
                    
                    'start': {
                        'dateTime': reservationData.startDateTime,
                        'timeZone': 'America/Santiago'
                    },
                    'end': {
                        'dateTime': reservationData.endDateTime,
                        'timeZone': 'America/Santiago'
                    },
                    'location': 'San Pedro de Atacama, Chile',
                    'attendees': [
                        {
                            'email': reservationData.email,
                            'displayName': reservationData.name
                        }
                    ],
                    'reminders': {
                        'useDefault': false,
                        'overrides': [
                            {'method': 'email', 'minutes': 24 * 60}, // 1 día antes
                            {'method': 'popup', 'minutes': 60}       // 1 hora antes
                        ]
                    }
                };

                // Crear el evento
                const response = await gapi.client.calendar.events.insert({
                    'calendarId': CALENDAR_ID,
                    'resource': event
                });

                console.log('Evento creado exitosamente:', response);
                return {
                    success: true,
                    eventId: response.result.id,
                    eventLink: response.result.htmlLink
                };

            } catch (error) {
                console.error('Error creando evento en Google Calendar:', error);
                return {
                    success: false,
                    error: error.message
                };
            }
        }

        // Función para procesar la reserva y crear evento
        async function processBookingWithCalendar(formData) {
            const currentLang = localStorage.getItem('preferred-language') || 'es';
            
            // Preparar datos de la reserva
            const reservationData = {
                name: formData.get('name'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                persons: formData.get('persons'),
                tourType: formData.get('tour-type'),
                date: formData.get('date'),
                time: formData.get('time'),
                comments: formData.get('comments'),
                startDateTime: `${formData.get('date')}T${formData.get('time')}:00`,
                endDateTime: calculateEndTime(formData.get('date'), formData.get('time'), formData.get('tour-type')),
                moonPhase: getMoonPhaseForDate(formData.get('date'))
            };

            // Intentar crear evento en Google Calendar
            const calendarResult = await createCalendarEvent(reservationData);
            
            if (calendarResult.success) {
                // Mostrar mensaje de éxito con información del calendario
                showBookingSuccess(reservationData, calendarResult, currentLang);
            } else {
                // Mostrar mensaje de éxito pero con advertencia sobre el calendario
                showBookingSuccessWithWarning(reservationData, calendarResult.error, currentLang);
            }
        }

        // Función auxiliar para calcular hora de fin según tipo de tour
        function calculateEndTime(date, startTime, tourType) {
            const [hours, minutes] = startTime.split(':');
            const startHour = parseInt(hours);
            
            // Tours privados duran 4 horas, tours regulares 3 horas
            const duration = tourType === 'private' ? 4 : 3;
            const endHour = startHour + duration;
            
            return `${date}T${endHour.toString().padStart(2, '0')}:${minutes}:00`;
        }

        // Función auxiliar para obtener fase lunar de una fecha
        function getMoonPhaseForDate(dateStr) {
            const date = new Date(dateStr);
            const moonPhase = getMoonPhase(date);
            return `${moonPhase.name} ${moonPhase.emoji} - ${moonPhase.illumination}% iluminación`;
        }

        // Mostrar mensaje de éxito con calendario
        function showBookingSuccess(reservation, calendar, lang) {
            const messages = {
                es: {
                    title: '¡Reserva Confirmada!',
                    calendar: 'Evento agregado a Google Calendar',
                    details: 'Detalles de tu reserva:',
                    date: 'Fecha',
                    time: 'Hora', 
                    persons: 'Personas',
                    contact: 'Te contactaremos pronto para confirmar detalles.'
                },
                en: {
                    title: 'Booking Confirmed!',
                    calendar: 'Event added to Google Calendar',
                    details: 'Your booking details:',
                    date: 'Date',
                    time: 'Time',
                    persons: 'Persons',
                    contact: 'We will contact you soon to confirm details.'
                },
                pt: {
                    title: 'Reserva Confirmada!',
                    calendar: 'Evento adicionado ao Google Calendar',
                    details: 'Detalhes da sua reserva:',
                    date: 'Data',
                    time: 'Hora',
                    persons: 'Pessoas',
                    contact: 'Entraremos em contato em breve para confirmar detalhes.'
                }
            };

            const msg = messages[lang] || messages['es'];
            
            const tourTypeText = reservation.tourType === 'private' ? 
                (lang === 'en' ? 'Private Tour' : lang === 'pt' ? 'Tour Privado' : 'Tour Privado') :
                (lang === 'en' ? 'Regular Tour' : lang === 'pt' ? 'Tour Regular' : 'Tour Regular');

            alert(`${msg.title}
            
✅ ${msg.calendar}

${msg.details}
🎯 ${lang === 'en' ? 'Type' : lang === 'pt' ? 'Tipo' : 'Tipo'}: ${tourTypeText}
📅 ${msg.date}: ${reservation.date}
🕐 ${msg.time}: ${reservation.time}
👥 ${msg.persons}: ${reservation.persons}

${msg.contact}`);
        }

        // Mostrar mensaje con advertencia sobre calendario
        function showBookingSuccessWithWarning(reservation, error, lang) {
            const messages = {
                es: {
                    title: '✅ ¡Reserva Enviada Correctamente!',
                    success: 'Tu reserva ha sido recibida y procesada.',
                    calendarNote: 'Nota: Google Calendar automático no está disponible en modo de desarrollo local.',
                    instructions: 'En producción, las reservas se agregan automáticamente a nuestro calendario.',
                    manual: 'Datos de tu reserva:',
                    contact: '📞 Te contactaremos dentro de 24 horas para confirmar todos los detalles.',
                    whatsapp: '¿Tienes preguntas? Escríbenos por WhatsApp: +56 9 3513 4669'
                },
                en: {
                    title: '✅ Booking Sent Successfully!',
                    success: 'Your booking has been received and processed.',
                    calendarNote: 'Note: Automatic Google Calendar is not available in local development mode.',
                    instructions: 'In production, bookings are automatically added to our calendar.',
                    manual: 'Your booking details:',
                    contact: '📞 We will contact you within 24 hours to confirm all details.',
                    whatsapp: 'Have questions? Write us on WhatsApp: +56 9 3513 4669'
                },
                pt: {
                    title: '✅ Reserva Enviada com Sucesso!',
                    success: 'Sua reserva foi recebida e processada.',
                    calendarNote: 'Nota: Google Calendar automático não está disponível no modo de desenvolvimento local.',
                    instructions: 'Em produção, as reservas são automaticamente adicionadas ao nosso calendário.',
                    manual: 'Detalhes da sua reserva:',
                    contact: '📞 Entraremos em contato em 24 horas para confirmar todos os detalhes.',
                    whatsapp: 'Tem dúvidas? Escreva-nos no WhatsApp: +56 9 3513 4669'
                }
            };

            const msg = messages[lang] || messages['es'];

            // Create a more user-friendly modal instead of alert
            const modal = document.createElement('div');
            modal.className = 'booking-success-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>${msg.title}</h3>
                        <button class="close-modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <p class="success-message">${msg.success}</p>
                        
                        <div class="booking-details">
                            <h4>${msg.manual}</h4>
                            <div class="detail-row">
                                <span class="label">📅 Fecha:</span>
                                <span class="value">${reservation.date}</span>
                            </div>
                            <div class="detail-row">
                                <span class="label">⏰ Hora:</span>
                                <span class="value">${reservation.time}</span>
                            </div>
                            <div class="detail-row">
                                <span class="label">👥 Personas:</span>
                                <span class="value">${reservation.persons}</span>
                            </div>
                        </div>
                        
                        <div class="calendar-info">
                            <p class="note">${msg.calendarNote}</p>
                            <p class="instructions">${msg.instructions}</p>
                        </div>
                        
                        <div class="contact-info">
                            <p class="contact">${msg.contact}</p>
                            <p class="whatsapp">${msg.whatsapp}</p>
                        </div>
                    </div>
                </div>
            `;

            // Add styles for the modal
            const style = document.createElement('style');
            style.textContent = `
                .booking-success-modal {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.8);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                    padding: 1rem;
                }
                .booking-success-modal .modal-content {
                    background: #1a1a1a;
                    border: 2px solid #00D4FF;
                    border-radius: 12px;
                    max-width: 500px;
                    width: 100%;
                    max-height: 90vh;
                    overflow-y: auto;
                }
                .booking-success-modal .modal-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 1rem 1.5rem;
                    background: #2a2a2a;
                    border-bottom: 1px solid #00D4FF;
                }
                .booking-success-modal h3 {
                    color: #00D4FF;
                    margin: 0;
                    font-size: 1.3rem;
                }
                .booking-success-modal .close-modal {
                    background: none;
                    border: none;
                    color: #fff;
                    font-size: 1.5rem;
                    cursor: pointer;
                    padding: 0;
                    line-height: 1;
                }
                .booking-success-modal .modal-body {
                    padding: 1.5rem;
                    color: #fff;
                }
                .booking-success-modal .success-message {
                    color: #4CAF50;
                    font-weight: bold;
                    margin-bottom: 1.5rem;
                    text-align: center;
                    font-size: 1.1rem;
                }
                .booking-success-modal .booking-details {
                    background: #333;
                    border-radius: 8px;
                    padding: 1rem;
                    margin-bottom: 1rem;
                }
                .booking-success-modal .booking-details h4 {
                    color: #00D4FF;
                    margin-bottom: 0.75rem;
                    font-size: 1rem;
                }
                .booking-success-modal .detail-row {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 0.5rem 0;
                    border-bottom: 1px solid #555;
                }
                .booking-success-modal .detail-row:last-child {
                    border-bottom: none;
                }
                .booking-success-modal .label {
                    font-weight: bold;
                    color: #ccc;
                }
                .booking-success-modal .value {
                    color: #00D4FF;
                    font-weight: bold;
                }
                .booking-success-modal .calendar-info {
                    background: rgba(255, 165, 0, 0.1);
                    border-left: 4px solid #FFA500;
                    padding: 1rem;
                    margin-bottom: 1rem;
                    border-radius: 4px;
                }
                .booking-success-modal .note {
                    color: #FFA500;
                    font-weight: bold;
                    margin-bottom: 0.5rem;
                    font-size: 0.9rem;
                }
                .booking-success-modal .instructions {
                    color: #ccc;
                    font-size: 0.9rem;
                    margin: 0;
                }
                .booking-success-modal .contact-info {
                    background: rgba(0, 212, 255, 0.1);
                    border-radius: 8px;
                    padding: 1rem;
                    text-align: center;
                }
                .booking-success-modal .contact {
                    color: #00D4FF;
                    font-weight: bold;
                    margin-bottom: 0.5rem;
                }
                .booking-success-modal .whatsapp {
                    color: #4CAF50;
                    font-size: 0.9rem;
                    margin: 0;
                }
            `;

            document.head.appendChild(style);
            document.body.appendChild(modal);

            // Close modal functionality
            const closeBtn = modal.querySelector('.close-modal');
            closeBtn.addEventListener('click', () => {
                document.body.removeChild(modal);
                document.head.removeChild(style);
            });

            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                    document.head.removeChild(style);
                }
            });
        }

        // Inicializar Google API cuando se carga la página
        if (typeof gapi !== 'undefined') {
            initializeGoogleAPI();
        }
    </script>

    <!-- Sistema de horarios dinámicos por temporada y tipo de tour -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tourTypeSelect = document.getElementById('tour-type');
            const timeSelect = document.getElementById('time');
            const timeInfo = document.querySelector('.time-info');

            if (!tourTypeSelect || !timeSelect) return;

            // Función para determinar la temporada basada en el cambio de horario de Chile
            function getCurrentSeason() {
                const currentDate = new Date();
                const month = currentDate.getMonth() + 1; // 1-12
                const day = currentDate.getDate();
                
                // Horario de invierno en Chile: primer domingo de abril a primer domingo de septiembre
                // Horario de verano en Chile: primer domingo de septiembre a primer domingo de abril
                // Simplificado: abril-agosto = invierno, septiembre-marzo = verano
                if (month >= 4 && month <= 8) {
                    return 'invierno';
                } else {
                    return 'verano';
                }
            }

            // Configuración de horarios
            function getTourSchedules() {
                const season = getCurrentSeason();
                const currentLang = localStorage.getItem('preferred-language') || 'es';
                
                const schedules = {
                    regular: {
                        invierno: {
                            times: ['19:30'],
                            info: {
                                es: 'Tour regular de invierno - Inicio: 19:30 hrs (Duración: 3 horas)',
                                en: 'Winter regular tour - Start: 7:30 PM (Duration: 3 hours)',
                                pt: 'Tour regular de inverno - Início: 19:30 (Duração: 3 horas)'
                            }
                        },
                        verano: {
                            times: ['20:30'],
                            info: {
                                es: 'Tour regular de verano - Inicio: 20:30 hrs (Duración: 3 horas)',
                                en: 'Summer regular tour - Start: 8:30 PM (Duration: 3 hours)', 
                                pt: 'Tour regular de verão - Início: 20:30 (Duração: 3 horas)'
                            }
                        }
                    },
                    private: {
                        invierno: {
                            times: ['flexible'],
                            info: {
                                es: 'Tour privado - Horario flexible según tus preferencias (Duración: 3-4 horas)',
                                en: 'Private tour - Flexible schedule according to your preferences (Duration: 3-4 hours)',
                                pt: 'Tour privado - Horário flexível conforme suas preferências (Duração: 3-4 horas)'
                            }
                        },
                        verano: {
                            times: ['flexible'],
                            info: {
                                es: 'Tour privado - Horario flexible según tus preferencias (Duración: 3-4 horas)',
                                en: 'Private tour - Flexible schedule according to your preferences (Duration: 3-4 hours)',
                                pt: 'Tour privado - Horário flexível conforme suas preferências (Duração: 3-4 horas)'
                            }
                        }
                    },
                    astrophoto: {
                        invierno: {
                            times: ['22:30'],
                            info: {
                                es: 'Tour astrofotográfico especializado - Inicio: 22:30 hrs (Duración: 4-5 horas). Incluye técnicas de fotografía nocturna y equipo especializado.',
                                en: 'Specialized astrophotography tour - Start: 10:30 PM (Duration: 4-5 hours). Includes night photography techniques and specialized equipment.',
                                pt: 'Tour astrofotográfico especializado - Início: 22:30 (Duração: 4-5 horas). Inclui técnicas de fotografia noturna e equipamento especializado.'
                            }
                        },
                        verano: {
                            times: ['23:30'],
                            info: {
                                es: 'Tour astrofotográfico especializado - Inicio: 23:30 hrs (Duración: 4-5 horas). Incluye técnicas de fotografía nocturna y equipo especializado.',
                                en: 'Specialized astrophotography tour - Start: 11:30 PM (Duration: 4-5 hours). Includes night photography techniques and specialized equipment.',
                                pt: 'Tour astrofotográfico especializado - Início: 23:30 (Duração: 4-5 horas). Inclui técnicas de fotografia noturna e equipamento especializado.'
                            }
                        }
                    }
                };

                return schedules;
            }

            // Actualizar horarios cuando se cambia el tipo de tour
            tourTypeSelect.addEventListener('change', function() {
                const tourType = this.value;
                const schedules = getTourSchedules();
                const season = getCurrentSeason();
                const currentLang = localStorage.getItem('preferred-language') || 'es';

                // Limpiar opciones anteriores
                timeSelect.innerHTML = '';

                if (!tourType) {
                    timeSelect.innerHTML = '<option value="">Primero selecciona tipo de tour</option>';
                    timeInfo.textContent = '';
                    return;
                }

                // Agregar opción por defecto
                const defaultText = {
                    es: 'Selecciona horario',
                    en: 'Select time',
                    pt: 'Selecione horário'
                };
                timeSelect.innerHTML = `<option value="">${defaultText[currentLang] || defaultText['es']}</option>`;

                // Obtener horarios para el tipo de tour y temporada actual
                const tourSchedule = schedules[tourType] && schedules[tourType][season];
                
                if (tourSchedule) {
                    // Agregar horarios disponibles
                    tourSchedule.times.forEach(time => {
                        const option = document.createElement('option');
                        option.value = time;
                        if (time === 'flexible') {
                            const flexibleText = {
                                es: 'Horario a coordinar',
                                en: 'Schedule to coordinate', 
                                pt: 'Horário a coordenar'
                            };
                            option.textContent = flexibleText[currentLang] || flexibleText['es'];
                        } else {
                            option.textContent = `${time} hrs`;
                        }
                        timeSelect.appendChild(option);
                    });

                    // Mostrar información sobre el horario
                    const info = tourSchedule.info[currentLang] || tourSchedule.info['es'];
                    timeInfo.textContent = info;
                    
                    // If only one time option, select it automatically
                    if (tourSchedule.times.length === 1) {
                        timeSelect.value = tourSchedule.times[0];
                        updateSelectedTime(tourSchedule.times[0]);
                    }
                } else {
                    timeInfo.textContent = 'Horarios no disponibles para esta configuración';
                }
            });

            // Actualizar horarios cuando se cambia el idioma
            function updateScheduleLanguage() {
                const tourType = tourTypeSelect.value;
                if (tourType) {
                    // Trigger change event to refresh schedule info
                    tourTypeSelect.dispatchEvent(new Event('change'));
                }
            }

            // Function to update the hidden time field
            function updateSelectedTime(time) {
                const selectedTimeInput = document.getElementById('selected-time');
                if (selectedTimeInput) {
                    selectedTimeInput.value = time;
                    selectedTimeInput.dispatchEvent(new Event('change'));
                }
            }
            
            // Listen for time selection changes
            timeSelect.addEventListener('change', function() {
                const selectedTime = this.value;
                if (selectedTime) {
                    updateSelectedTime(selectedTime);
                }
            });

            // Escuchar cambios de idioma
            const langOptions = document.querySelectorAll('.lang-option');
            langOptions.forEach(option => {
                option.addEventListener('click', function() {
                    setTimeout(updateScheduleLanguage, 100);
                });
            });
        });
    </script>

    <!-- Sistema de control de disponibilidad y alertas -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const personsSelect = document.getElementById('persons');
            const tourTypeSelect = document.getElementById('tour-type');
            const availabilityWarning = document.getElementById('availability-warning');
            const warningText = availabilityWarning.querySelector('.warning-text');

            // Sistema simulado de reservas (en producción sería desde una base de datos)
            // Formato: { fecha: { regular: ocupados, private: ocupados } }
            let reservations = {};

            // Obtener idioma actual
            function getCurrentLang() {
                return localStorage.getItem('preferred-language') || 'es';
            }

            // Mensajes de alerta por idioma
            const messages = {
                es: {
                    lastSpots: '¡Últimos cupos disponibles!',
                    spotsLeft: 'quedan solo',
                    spots: 'cupos',
                    hurryUp: 'Reserva ahora antes de que se agoten',
                    full: 'Sin cupos disponibles para esta fecha',
                    private: 'Tour privado - Sin límite de participantes'
                },
                en: {
                    lastSpots: 'Last spots available!',
                    spotsLeft: 'only',
                    spots: 'spots left',
                    hurryUp: 'Book now before they sell out',
                    full: 'No spots available for this date',
                    private: 'Private tour - No participant limit'
                },
                pt: {
                    lastSpots: 'Últimas vagas disponíveis!',
                    spotsLeft: 'restam apenas',
                    spots: 'vagas',
                    hurryUp: 'Reserve agora antes que esgote',
                    full: 'Sem vagas disponíveis para esta data',
                    private: 'Tour privado - Sem limite de participantes'
                }
            };

            // Función para obtener ocupación de una fecha
            function getOccupancy(date, tourType) {
                const dateStr = typeof date === 'string' ? date : date.toISOString().split('T')[0];
                if (!reservations[dateStr]) {
                    reservations[dateStr] = { regular: 0, private: 0 };
                }
                return reservations[dateStr][tourType] || 0;
            }

            // Función para simular reservas existentes (en producción vendría del servidor)
            function simulateExistingReservations() {
                const today = new Date();
                for (let i = 1; i <= 30; i++) {
                    const date = new Date(today);
                    date.setDate(today.getDate() + i);
                    const dateStr = date.toISOString().split('T')[0];
                    
                    // Simular ocupación aleatoria pero realista
                    const randomOccupancy = Math.floor(Math.random() * 16);
                    const astrophotoOccupancy = Math.floor(Math.random() * 8);
                    reservations[dateStr] = {
                        regular: randomOccupancy,
                        private: Math.floor(Math.random() * 3), // Tours privados menos frecuentes
                        astrophoto: astrophotoOccupancy
                    };
                }
            }

            // Función para verificar disponibilidad y mostrar alertas
            function checkAvailabilityAndShowWarning() {
                const selectedDate = document.getElementById('selected-date').value;
                const tourType = tourTypeSelect.value;
                const persons = parseInt(personsSelect.value) || 0;

                if (!selectedDate || !tourType || !persons) {
                    availabilityWarning.style.display = 'none';
                    return;
                }

                const currentLang = getCurrentLang();
                const msg = messages[currentLang];

                if (tourType === 'private') {
                    // Tours privados no tienen límite
                    availabilityWarning.style.display = 'block';
                    availabilityWarning.className = 'availability-warning private';
                    warningText.textContent = msg.private;
                    return;
                }

                if (tourType === 'astrophoto') {
                    // Tours astrofotográficos tienen límite de 8 personas (más especializado)
                    const occupied = getOccupancy(selectedDate, 'astrophoto');
                    const maxCapacity = 8;
                    const available = maxCapacity - occupied;
                    const remaining = available - persons;

                    availabilityWarning.style.display = 'block';

                    if (remaining < 0) {
                        availabilityWarning.className = 'availability-warning full';
                        warningText.textContent = msg.full;
                    } else if (remaining <= 2 && remaining >= 0) {
                        availabilityWarning.className = 'availability-warning last-spots';
                        warningText.innerHTML = `
                            <strong>${msg.lastSpots}</strong><br>
                            ${msg.spotsLeft} ${remaining} ${msg.spots}. ${msg.hurryUp}!
                        `;
                    } else {
                        availabilityWarning.style.display = 'none';
                    }

                    updatePersonsOptions(available, 8);
                    return;
                }

                // Para tours regulares
                const occupied = getOccupancy(selectedDate, 'regular');
                const maxCapacity = 16;
                const available = maxCapacity - occupied;
                const remaining = available - persons;

                availabilityWarning.style.display = 'block';

                if (remaining < 0) {
                    // Sin cupos suficientes
                    availabilityWarning.className = 'availability-warning full';
                    warningText.textContent = msg.full;
                } else if (remaining <= 3 && remaining >= 0) {
                    // Últimos cupos
                    availabilityWarning.className = 'availability-warning last-spots';
                    warningText.innerHTML = `
                        <strong>${msg.lastSpots}</strong><br>
                        ${msg.spotsLeft} ${remaining} ${msg.spots}. ${msg.hurryUp}!
                    `;
                } else {
                    // Suficientes cupos
                    availabilityWarning.style.display = 'none';
                }

                // Actualizar opciones del selector de personas basado en disponibilidad
                updatePersonsOptions(available, 16);
            }

            // Actualizar opciones disponibles en el selector de personas
            function updatePersonsOptions(available, maxCapacity = 16) {
                const currentValue = personsSelect.value;
                const options = personsSelect.querySelectorAll('option');
                
                options.forEach(option => {
                    const value = parseInt(option.value);
                    if (value && value > available && value <= maxCapacity) {
                        option.style.display = 'none';
                        option.disabled = true;
                    } else if (value && value <= maxCapacity) {
                        option.style.display = 'block';
                        option.disabled = false;
                    } else if (value && value > maxCapacity) {
                        // Ocultar opciones que exceden el máximo del tipo de tour
                        option.style.display = 'none';
                        option.disabled = true;
                    }
                });

                // Si la selección actual no está disponible, limpiar
                if (parseInt(currentValue) > available) {
                    personsSelect.value = '';
                }
            }

            // Event listeners
            personsSelect.addEventListener('change', checkAvailabilityAndShowWarning);
            tourTypeSelect.addEventListener('change', checkAvailabilityAndShowWarning);

            // Escuchar cambios en la fecha seleccionada
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'value') {
                        checkAvailabilityAndShowWarning();
                    }
                });
            });

            const selectedDateInput = document.getElementById('selected-date');
            if (selectedDateInput) {
                observer.observe(selectedDateInput, {
                    attributes: true,
                    attributeFilter: ['value']
                });
            }

            // Inicializar simulación de reservas
            simulateExistingReservations();
        });
    </script>

    <!-- Estilos para el calendario personalizado -->
    <style>
        .custom-calendar {
            background: #1a1a1a;
            border: 1px solid #00D4FF;
            border-radius: 8px;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: #2a2a2a;
            border-bottom: 1px solid #00D4FF;
        }
        
        .calendar-header h3 {
            margin: 0;
            color: #00D4FF;
            font-size: 1.2rem;
        }
        
        .nav-btn {
            background: #00D4FF;
            color: #000;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .nav-btn:hover {
            background: #00B4D8;
            transform: scale(1.1);
        }
        
        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: #333;
        }
        
        .weekday {
            padding: 0.75rem;
            text-align: center;
            color: #00D4FF;
            font-weight: bold;
            font-size: 0.9rem;
            border-right: 1px solid #555;
        }
        
        .weekday:last-child {
            border-right: none;
        }
        
        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #555;
        }
        
        .calendar-day {
            background: #1a1a1a;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            padding: 0.5rem;
        }
        
        .calendar-day:hover {
            background: #2a2a2a;
            transform: scale(1.05);
        }
        
        .calendar-day.empty {
            cursor: default;
            opacity: 0;
        }
        
        .calendar-day.today {
            background: rgba(0, 212, 255, 0.2);
            border: 2px solid #00D4FF;
        }
        
        .calendar-day.selected {
            background: #00D4FF;
            color: #000;
        }
        
        .calendar-day.unavailable {
            background: rgba(255, 0, 0, 0.1);
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .calendar-day.unavailable:hover {
            transform: none;
            background: rgba(255, 0, 0, 0.1);
        }
        
        .day-number {
            font-size: 1rem;
            font-weight: bold;
            color: #fff;
            margin-bottom: 0.25rem;
        }
        
        .calendar-day.selected .day-number {
            color: #000;
        }
        
        .moon-emoji {
            font-size: 0.8rem;
            line-height: 1;
        }
        
        .calendar-legend {
            display: flex;
            justify-content: center;
            gap: 2rem;
            padding: 1rem;
            background: #2a2a2a;
            border-top: 1px solid #555;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: #ccc;
        }
        
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .legend-dot.available {
            background: #4CAF50;
        }
        
        .legend-dot.unavailable {
            background: rgba(255, 0, 0, 0.6);
        }
        
        .date-confirmation {
            margin-top: 1rem;
            padding: 1rem;
            background: #1a1a1a;
            border: 1px solid #00D4FF;
            border-radius: 8px;
            text-align: center;
            animation: slideIn 0.3s ease;
        }
        
        .confirmation-icon {
            color: #4CAF50;
            margin-bottom: 0.5rem;
        }
        
        .confirmation-icon i {
            font-size: 1.5rem;
        }
        
        .date-confirmation h4 {
            color: #00D4FF;
            margin: 0.5rem 0;
        }
        
        .date-confirmation p {
            margin: 0.25rem 0;
            color: #fff;
        }
        
        .date-confirmation .conditions {
            font-size: 0.9rem;
            color: #ccc;
            margin-top: 0.5rem;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Estilos para el selector de idiomas */
        .lang-selector {
            position: relative;
        }
        
        .lang-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: transparent;
            border: 1px solid #00D4FF;
            color: #00D4FF;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .lang-btn:hover {
            background: #00D4FF;
            color: #000;
        }
        
        .lang-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: #1a1a1a;
            border: 2px solid #00D4FF;
            border-radius: 8px;
            min-width: 160px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
            margin-top: 0.5rem;
            box-shadow: 0 8px 32px rgba(0, 212, 255, 0.2);
        }
        
        .lang-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .lang-option {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #fff;
            font-weight: 500;
            border-bottom: 1px solid rgba(0, 212, 255, 0.2);
        }
        
        .lang-option:last-child {
            border-bottom: none;
        }
        
        .lang-option:hover {
            background: rgba(0, 212, 255, 0.1);
            color: #00D4FF;
            transform: translateX(2px);
        }
        
        .lang-option:first-child {
            border-radius: 6px 6px 0 0;
        }
        
        .lang-option:last-child {
            border-radius: 0 0 6px 6px;
        }
        
        .lang-option.active {
            background: #00D4FF;
            color: #000;
            font-weight: bold;
        }
        
        .lang-option.active:hover {
            background: #00B4D8;
            transform: none;
        }
        
        .flag {
            font-size: 1.1rem;
        }

        @media (max-width: 768px) {
            /* Prevent horizontal overflow globally */
            * {
                max-width: 100%;
            }
            
            body {
                overflow-x: hidden;
                width: 100%;
            }
            
            .calendar-container,
            #calendar-container {
                width: 100%;
                max-width: 100%;
                margin: 0;
                padding: 0;
                overflow-x: hidden;
            }
            
            .booking .container {
                width: 100%;
                max-width: 100%;
                padding: 0 0.5rem;
                overflow-x: hidden;
            }
            
            .custom-calendar {
                width: 100%;
                margin: 0;
                padding: 0.5rem;
                box-sizing: border-box;
            }
            
            .calendar-header {
                padding: 0 0.5rem;
                margin-bottom: 0.5rem;
            }
            
            .calendar-weekdays {
                display: grid;
                grid-template-columns: repeat(7, 1fr);
                gap: 1px;
                background: #555;
                width: 100%;
            }
            
            .weekday {
                padding: 0.3rem;
                font-size: 0.7rem;
                text-align: center;
            }
            
            .calendar-days {
                display: grid;
                grid-template-columns: repeat(7, 1fr);
                gap: 1px;
                background: #555;
                width: 100%;
            }
            
            .calendar-day {
                min-height: 40px;
                padding: 0.1rem;
                font-size: 0.7rem;
                aspect-ratio: 1;
            }
            
            .day-number {
                font-size: 0.7rem;
                margin-bottom: 0;
            }
            
            .moon-icon {
                font-size: 8px;
                bottom: 1px;
                right: 1px;
            }
            
            .moon-emoji {
                font-size: 0.7rem;
            }
            
            .calendar-header h3 {
                font-size: 1rem;
            }
            
            .nav-btn {
                width: 30px;
                height: 30px;
                font-size: 1rem;
            }
            
            .calendar-legend {
                flex-direction: column;
                gap: 0.5rem;
                align-items: center;
            }
            
            .lang-dropdown {
                right: -20px;
            }
            
            .lang-btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }
        }
    </style>

    <!-- Booking Form Handler -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Setting up booking form handler...');
            
            // Manejar envío del formulario de reservas
            const bookingForm = document.getElementById('booking-form');
            if (bookingForm) {
                console.log('Booking form found, adding event listener');
                
                bookingForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    console.log('Booking form submitted');
                    
                    // Obtener datos del formulario
                    const formData = new FormData(bookingForm);
                    const bookingData = {
                        date: formData.get('date'),
                        persons: formData.get('persons'),
                        tourType: formData.get('tour-type'),
                        name: formData.get('name'),
                        email: formData.get('email'),
                        phone: formData.get('phone'),
                        message: formData.get('message') || ''
                    };
                    
                    console.log('Form data collected:', bookingData);
                    
                    // Validar datos requeridos
                    if (!bookingData.date || !bookingData.persons || !bookingData.tourType || !bookingData.name || !bookingData.email || !bookingData.phone) {
                        console.log('Validation failed - missing required fields');
                        alert('Por favor completa todos los campos obligatorios');
                        return;
                    }
                    
                    console.log('Client-side validation passed');
                    
                    // Mostrar loading en el botón
                    const submitBtn = bookingForm.querySelector('button[type="submit"]');
                    const originalText = submitBtn.textContent;
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'Enviando...';
                    
                    try {
                        console.log('Sending API request to /api/booking');
                        
                        // Enviar a la API
                        const response = await fetch('/api/booking', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(bookingData)
                        });
                        
                        console.log('API response status:', response.status);
                        
                        const result = await response.json();
                        console.log('API response data:', result);
                        
                        if (response.ok && result.success) {
                            console.log('Booking successful, redirecting to confirmation page');
                            // Redirect a página de confirmación con fecha
                            const selectedDateElement = document.getElementById('selected-date');
                            const tourDate = selectedDateElement ? selectedDateElement.value : formData.date;
                            console.log('Date for confirmation page:', tourDate);
                            window.location.href = `confirmacion.html?id=${encodeURIComponent(result.bookingId)}&date=${encodeURIComponent(tourDate)}`;
                        } else {
                            console.error('API returned error:', result);
                            throw new Error(result.error || 'Error al procesar la reserva');
                        }
                        
                    } catch (error) {
                        console.error('Booking submission error:', error);
                        alert(`Error al enviar la reserva: ${error.message}. Por favor intenta nuevamente.`);
                        
                        // Restaurar botón
                        submitBtn.disabled = false;
                        submitBtn.textContent = originalText;
                    }
                });
            } else {
                console.error('Booking form not found!');
            }
        });
    </script>
    
    <!-- Performance optimization script -->
    <script>
    // CLS Prevention and smooth loading
    (function() {
        // Prevent layout shifts during initial load
        document.documentElement.style.setProperty('--hero-loaded', '1');
        
        // Force layout recalculation after critical CSS loads - NO DOM MODIFICATIONS
        document.addEventListener('DOMContentLoaded', function() {
            // Only make body visible, don't modify hero or nav dimensions
            // CSS already handles all sizing to prevent CLS
            document.body.style.visibility = 'visible';
            
            // Mark as loaded for any scripts that need to know
            document.documentElement.setAttribute('data-cls-optimized', 'true');
        });
        
        // Preload key images for faster loading
        const criticalImages = [
            'images/hero1.webp',
            'images/responsive/Nightskylogo-1x.webp',
            'images/responsive/regular3-2-1x.webp',
            'images/responsive/fotografico-1x.webp'
        ];
        
        criticalImages.forEach(src => {
            const link = document.createElement('link');
            link.rel = 'preload';
            link.as = 'image';
            link.href = src;
            document.head.appendChild(link);
        });
        
        // Font loading completion handler
        if ('fonts' in document) {
            document.fonts.ready.then(() => {
                document.documentElement.classList.add('fonts-loaded');
            });
        }
    })();
    </script>
</body>
</html>